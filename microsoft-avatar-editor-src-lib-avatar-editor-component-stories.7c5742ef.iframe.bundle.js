(self.webpackChunkangular_avatar_editors=self.webpackChunkangular_avatar_editors||[]).push([[318],{"./packages/microsoft-avatar-editor/src/lib/avatar-editor.component.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,default:()=>avatar_editor_component_stories});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var avatar_editor_componentngResource=__webpack_require__("./packages/microsoft-avatar-editor/src/lib/avatar-editor.component.scss?ngResource"),avatar_editor_componentngResource_default=__webpack_require__.n(avatar_editor_componentngResource),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs_interop=__webpack_require__("./node_modules/@angular/core/fesm2022/rxjs-interop.mjs"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");let NgxAvatarEditorStore=class NgxAvatarEditorStore{constructor(){this.imageSize=(0,core.signal)({naturalWidth:0,naturalHeight:0}),this.cropBounds=(0,core.signal)(new DOMRectReadOnly),this.initialScale=(0,core.computed)((()=>1/this.maximumScale())),this.maximumScale=(0,core.computed)((()=>Math.min(this.imageSize().naturalWidth/this.cropBounds().width,this.imageSize().naturalHeight/this.cropBounds().height))),this.absoluteScale=(0,core.signal)(1)}};NgxAvatarEditorStore=(0,tslib_es6.gn)([(0,core.Injectable)()],NgxAvatarEditorStore);let NgxAvatarEditorCanvasDirective=class NgxAvatarEditorCanvasDirective{#destroyRef=(0,core.inject)(core.DestroyRef);#elementRef=(0,core.inject)(core.ElementRef);#injector=(0,core.inject)(core.Injector);#store=(0,core.inject)(NgxAvatarEditorStore);#canvas=this.#elementRef.nativeElement;#context=this.#canvas.getContext("2d");#image=new Image;#translation=(0,core.signal)(new DOMPointReadOnly);get src(){return this.#src}set src(value){this.#src=value,this.#loadImage(this.#src)}#src;ngAfterViewInit(){(0,combineLatest.a)([(0,rxjs_interop.Dx)(this.#store.cropBounds,{injector:this.#injector}),(0,rxjs_interop.Dx)(this.#store.imageSize,{injector:this.#injector})]).pipe((0,rxjs_interop.sL)(this.#destroyRef)).subscribe((([bounds,size])=>this.#fitImage(bounds,size))),(0,core.effect)((()=>this.#draw(this.#translation())),{injector:this.#injector})}#loadImage(src){this.#image.onload=()=>{const{naturalWidth,naturalHeight}=this.#image;this.#store.imageSize.set({naturalWidth,naturalHeight})},this.#image.src=src}#fitImage(cropBounds,imageSize){const{naturalWidth,naturalHeight}=imageSize,{width,height}=cropBounds,x=(width-naturalWidth*this.#store.initialScale())/2,y=(height-naturalHeight*this.#store.initialScale())/2;this.#translation.set(new DOMPointReadOnly(x,y))}#draw(translation){const{naturalWidth,naturalHeight}=this.#store.imageSize(),{width,height}=this.#store.cropBounds();this.#context.fillRect(0,0,width,height),this.#context.save(),this.#context.translate(width/2,height/2),this.#context.transform(1,0,0,1,0,0),this.#context.translate(-1*width/2,-1*height/2),this.#context?.restore(),this.#context.drawImage(this.#image,translation.x,translation.y,naturalWidth*this.#store.absoluteScale()/this.#store.maximumScale(),naturalHeight*this.#store.absoluteScale()/this.#store.maximumScale())}static#_=this.propDecorators={src:[{type:core.Input,args:[{required:!0}]}]}};NgxAvatarEditorCanvasDirective=(0,tslib_es6.gn)([(0,core.Directive)({selector:"canvas[ngxAvatarEditorCanvas]",standalone:!0})],NgxAvatarEditorCanvasDirective);let NgxAvatarEditorComponent=class NgxAvatarEditorComponent{#store=(0,core.inject)(NgxAvatarEditorStore);ngAfterViewInit(){const canvasElement=this._canvas.nativeElement,bounds=canvasElement.getBoundingClientRect();canvasElement.width=bounds.width,canvasElement.height=bounds.height,this.#store.cropBounds.set(bounds)}static#_=this.propDecorators={src:[{type:core.Input,args:[{required:!0}]}],_canvas:[{type:core.ViewChild,args:[NgxAvatarEditorCanvasDirective,{read:core.ElementRef}]}]}};NgxAvatarEditorComponent=(0,tslib_es6.gn)([(0,core.Component)({selector:"ngx-avatar-editor",standalone:!0,imports:[common.CommonModule,NgxAvatarEditorCanvasDirective],template:'<canvas ngxAvatarEditorCanvas [src]="src"></canvas>\n<div id="shade"></div>\n',encapsulation:core.ViewEncapsulation.ShadowDom,changeDetection:core.ChangeDetectionStrategy.OnPush,providers:[NgxAvatarEditorStore],styles:[avatar_editor_componentngResource_default()]})],NgxAvatarEditorComponent);const avatar_editor_component_stories={component:NgxAvatarEditorComponent,title:"Components/MicrosoftAvatarEditor",parameters:{layout:"centered"}},Primary={args:{src:"grace-hilty-uvAhJHLul_Q-unsplash.jpg"}}},"./packages/microsoft-avatar-editor/src/lib/avatar-editor.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,":host {\n  display: block;\n  position: relative;\n  box-sizing: border-box;\n  outline: 0;\n  overflow: hidden;\n  width: 256px;\n  height: 600px;\n}\n\ncanvas[ngxAvatarEditorCanvas] {\n  width: 256px;\n  height: 256px;\n}\n\n#shade {\n  box-sizing: border-box;\n  position: absolute;\n  inset: 0;\n  max-height: 256px;\n  border-radius: 50%;\n  border: 2px solid rgba(255, 255, 255, 0.7);\n  outline: max(100vw, 100vh) solid rgba(255, 255, 255, 0.4);\n  pointer-events: none;\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);